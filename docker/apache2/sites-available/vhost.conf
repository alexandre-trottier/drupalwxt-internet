<VirtualHost *:80>

    ServerAdmin joel@openplus.ca
    DocumentRoot /var/www/html

    RewriteEngine On
    SSLProxyEngine On

    #DBDriver pgsql
    #DBDParams "host=localhost,username=postgres,password=WxT,database=redirects,port=5432"
    #RewriteMap rwmap "dbd:SELECT column FROM table WHERE column = %s"
    #RewriteCond ${rwmap:%{DOCUMENT_ROOT}%{REQUEST_FILENAME}} ^(.+)$ [NC]
    #RewriteRule ^/(.+)$ /${rwmap:%1} [L]

    #Rewrite if static file is found on the server
    RewriteCond %{DOCUMENT_ROOT}/static/%{REQUEST_FILENAME} -f
    RewriteRule ^/(.+)$ /static/$1 [L]

    #RewriteCond %{REQUEST_URI} ^(.*)?wp-login\.php(.*)$ [OR]
    #RewriteCond %{REQUEST_URI} ^(.*)?wp-admin$
    #RewriteCond %{REMOTE_ADDR} !^123\.123\.123\.123$
    #RewriteRule ^(.*)$ - [R=403,L]
    
    #Proxy on prem server for asp & aspx pages.    
    RewriteCond "%{REQUEST_FILENAME}" !-f
    RewriteCond "%{REQUEST_FILENAME}" !-d
    RewriteRule "^/(.+\.aspx?)$" https://www.tc.gc.ca/$1 [P]
    RewriteRule "^/(wwwdocs/.+)$" https://www.tc.gc.ca/$1 [P]
    RewriteRule "^/(wwwfiles/.+)$" https://www.tc.gc.ca/$1 [P]
    ProxyPassReverse / https://www.tc.gc.ca/

    UseCanonicalName Off
    ServerName wwwdev-tc-gc-ca.azurewebsites.net
    ServerAlias wwwtest-tc-gc-ca.azurewebsites.net
    ServerAlias www.tc.gc.ca
    ServerAlias tc.canada.ca

    <Directory "/var/www/html">
      Options Indexes FollowSymLinks
      AllowOverride All
      Order allow,deny
      Allow from all
    </Directory>

    <Location ~ "/(en|fr)/admin">
      Deny from all
      Allow from 198.103.96.11
      Allow from 198.103.96.78
      Allow from 127.0.0.1
    </Location>

    ErrorLog ${APACHE_LOG_DIR}/www-error.log
    CustomLog ${APACHE_LOG_DIR}/www-access.log combined

</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet